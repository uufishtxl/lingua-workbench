<template>
  <el-card shadow="hover" class="region-card" @click="emit('edit', region.id)">
    <div class="flex flex-col h-full text-sm">
      <!-- Top: Time and Delete button -->
      <div class="flex justify-between items-start mb-2">
        <span class="time-display">{{ formatTime(region.start) }} - {{ formatTime(region.end) }}</span>
        <el-button 
          type="danger" 
          :icon="Delete" 
          circle 
          size="small"
          @click.stop="emit('delete', region.id)" 
        />
      </div>

      <!-- Middle: Text snippet -->
      <p class="text-snippet flex-grow text-gray-600 mb-2">
        {{ region.originalText || 'No text provided.' }}
      </p>

      <!-- Bottom: Tags -->
      <div class="tag-icons flex gap-2 items-center">
        <el-tooltip content="Listen Practice" placement="top">
          <i-tabler-headphones v-show="region.tags.includes('listen')" class="text-lg text-blue-500" />
        </el-tooltip>
        <el-tooltip content="Speak Practice" placement="top">
          <i-tabler-volume v-show="region.tags.includes('speak')" class="text-lg text-green-500" />
        </el-tooltip>
      </div>
    </div>
  </el-card>
</template>

<script setup lang="ts">
import { Delete } from "@element-plus/icons-vue"

const props = defineProps<{
  region: {
    id: string;
    start: string;
    end: string;
    originalText: string;
    tags: string[];
    note: string;
  }
}>()

const emit = defineEmits(['delete', 'edit'])

const formatTime = (seconds: string | number): string => {
  const totalSeconds = typeof seconds === 'string' ? parseFloat(seconds) : seconds;
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const remainingSeconds = Math.floor(totalSeconds % 60);
  const pad = (num: number) => num.toString().padStart(2, '0');
  return `${pad(minutes)}:${pad(remainingSeconds)}`;
};
</script>

<style scoped>
.region-card {
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}
.region-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--el-box-shadow-dark);
}

.time-display {
  font-size: 0.85em;
  font-weight: 600;
  background-color: #ecf5ff;
  color: #409EFF;
  padding: 2px 8px;
  border-radius: 4px;
}

.text-snippet {
  display: -webkit-box;
  -webkit-line-clamp: 2; /* Limit to 2 lines */
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: 2.5em; /* Ensure it takes up space for 2 lines */
}
</style>