# 12-30 工作总结

## ✅ 已完成

### Whisper API 集成
- **`vite.config.ts`** - `/whisper` 代理到 `localhost:8001`
- **`audioUtils.ts`** - Web Audio API 提取音频片段 → WAV blob
- **`whisperApi.ts`** - 上传 + 轮询任务状态
- **`whisper_api.py`** - 添加 `skip_llm` 参数
- **`tasks.py`** - 根据 `skip_llm` 跳过 LLM 处理

### SliceCard 改进
- 🎤 手动转写按钮（替代自动转写）
- 动态字体大小（根据文本长度）
- 修复 Tag 选择器意外关闭问题
- `watch` 同步 `originalText` 到 `currentSlice.text`

---

## 📋 TODO: SliceCard AI 重构

> 详见 [12-30.SliceCardRefactor.markdown](./12-30.SliceCardRefactor.markdown)

**核心变更**：手动标注 → AI 驱动

| 删除 | 新增 |
|------|------|
| Select Tags 下拉框 | AI 自动注音 (Ruby Text) |
| IPA 软键盘 | AI 上下文菜单 |
| 手动标签 | LLM 多模式分析 |

**四个 LLM 模式**：
1. 视觉听觉乐谱（自动注音）
2. 听力显微镜（发音原理）
3. 习语文化深挖
4. 翻译纠错

---

## 🚀 TODO: 本地优先检索 (RAG)

**核心思路**：先从本地学习记录检索，找不到再调 LLM

```
用户选中 "gotta"
    ↓
Step 1: 本地检索（免费）→ 查之前标注过的片段
    ↓ 找到了？直接显示！
Step 2: 没找到 → 调 LLM（付费）→ 存入本地供复用
```

**好处**：
- 💰 省 Token
- ⚡ 本地更快
- 📚 个人语料库自动积累

**技术方案**：
- SQLite 全文索引 或 向量库 (Chroma/sqlite-vec)
- LangGraph 编排：检索 → 条件判断 → LLM 或本地结果
