# å‰ç«¯å­¦ä¹ ç¬”è®°

## ğŸ“Œ çŸ¥è¯†ç‚¹é€ŸæŸ¥

| çŸ¥è¯†ç‚¹ | ä¸€å¥è¯è§£é‡Š |
|--------|-----------|
| **Blob** | æµè§ˆå™¨ä¸­è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„å¯¹è±¡ï¼Œç”¨äºæ–‡ä»¶å¤„ç†ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ |
| **Fetch vs Axios** | Axios æ˜¯ Fetch çš„å°è£…ï¼Œè‡ªåŠ¨å¤„ç† JSON è§£æã€é”™è¯¯æŠ›å‡ºã€æŸ¥è¯¢å‚æ•°æ‹¼æ¥ï¼›æŸ¥è¯¢å‚æ•°æœ¬è´¨éƒ½æ˜¯å­—ç¬¦ä¸² |
| **Axios æ³›å‹** | `axios.post<T>()` çš„æ³›å‹ T æŒ‡å®šçš„æ˜¯ `response.data` çš„ç±»å‹ï¼Œè€Œéæ•´ä¸ª response |
| **Vite Proxy vs CORS** | Vite Proxy ä»…åœ¨å¼€å‘ç¯å¢ƒç»•è¿‡è·¨åŸŸï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¾èµ–åç«¯ CORS é…ç½® |
| **Fetch Response è¯»å–** | `.json()` / `.text()` / `.arrayBuffer()` / `.blob()` æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©ï¼Œåªèƒ½è¯»ä¸€æ¬¡ |
| **FormData** | é”®å€¼å¯¹é›†åˆï¼Œç”¨äºæ„å»ºè¡¨å•æ•°æ®ä¸Šä¼ ï¼›`append(key, value, filename)` æ·»åŠ å­—æ®µ |
| **éŸ³é¢‘æˆªå–** | Web Audio APIï¼šä¸‹è½½ â†’ è§£ç  AudioBuffer â†’ æŒ‰æ—¶é—´æˆªå– â†’ ç¼–ç  WAV Blob |
| **è§£æ„é»˜è®¤å€¼** | `const { a = 1 } = obj` å½“ `obj.a` ä¸º `undefined` æ—¶ä½¿ç”¨é»˜è®¤å€¼ |
| **Promise è½®è¯¢** | å¾ªç¯ä¸­ `await sleep()` ç­‰å¾…ï¼Œæ ¹æ®çŠ¶æ€ `return`(fulfilled) æˆ– `throw`(rejected) |
| **Vue watch immediate** | `{ immediate: true }` è®© watch åœ¨åˆå§‹åŒ–æ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œè€Œéç­‰å€¼å˜åŒ– |
| **HTML title å±æ€§** | åŸç”Ÿ HTML å±æ€§ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ”¯æŒï¼Œæ˜¾ç¤ºæµè§ˆå™¨åŸç”Ÿ tooltip |
| **el-button text** | Element Plus æŒ‰é’®å±æ€§ï¼Œç§»é™¤èƒŒæ™¯å’Œè¾¹æ¡†ï¼Œåªä¿ç•™æ–‡å­—/å›¾æ ‡ |
| **Tailwind å°æ•°é—´è·** | v3+ æ”¯æŒ `gap-1.5`(6px)ã€`gap-0.5`(2px) ç­‰ï¼Œæ— éœ€ `gap-[6px]` |
| **flex-1 vs shrink-0** | `flex-1` å æ»¡å‰©ä½™ç©ºé—´ï¼Œ`shrink-0` ç¦æ­¢æ”¶ç¼©ä¿æŒåŸå°ºå¯¸ |
| **Vue .prevent ä¿®é¥°ç¬¦** | `@keydown.enter.prevent` é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚ enter æ¢è¡Œï¼‰ |
| **Composable** | Vue 3 å¯å¤ç”¨é€»è¾‘å‡½æ•°ï¼Œå°è£… ref/computed/æ–¹æ³•ï¼Œç”Ÿå‘½å‘¨æœŸä¸è°ƒç”¨ç»„ä»¶ç»‘å®š |
| **Map vs Object** | Map æ”¯æŒä»»æ„é”®ç±»å‹ã€ä¿è¯é¡ºåºã€é¢‘ç¹å¢åˆ æ›´å¿«ï¼›åŠ¨æ€ key åœºæ™¯ç”¨ Map |
| **Tailwind group** | çˆ¶å­è”åŠ¨ï¼šçˆ¶å…ƒç´ åŠ  `group`ï¼Œå­å…ƒç´ ç”¨ `group-hover:` å®ç°æ‚¬åœæ—¶æ˜¾ç¤º |
| **é—­åŒ… (Closure)** | å‡½æ•° + å®ƒè®°ä½çš„å¤–éƒ¨å˜é‡ï¼›è®©å‡½æ•°èƒ½è®¿é—®åˆ›å»ºæ—¶çš„ä¸Šä¸‹æ–‡ |
| **Vue äº‹ä»¶é—­åŒ…æ¨¡å¼** | `@event="(val) => handler(id, val)"` â€” é—­åŒ…æ•è· v-for çš„ idï¼Œå­ç»„ä»¶åªä¼ å€¼ |

---

## 1. Fetch vs Axios

> **ä¸€å¥è¯**ï¼šAxios æ˜¯å¯¹ Fetch çš„å°è£…ï¼Œæ›´æ˜“ç”¨ã€‚

### å¯¹æ¯”

| ç‰¹æ€§ | Axios | Fetch |
|------|-------|-------|
| æŸ¥è¯¢å‚æ•° | `params: {}` è‡ªåŠ¨å¤„ç† | éœ€æ‰‹åŠ¨æ‹¼æ¥ URL |
| å“åº”æ•°æ® | `response.data` ç›´æ¥æ‹¿ | éœ€ `await response.json()` |
| é”™è¯¯å¤„ç† | 4xx/5xx è‡ªåŠ¨æŠ›å¼‚å¸¸ | éœ€æ£€æŸ¥ `response.ok` |
| è¯·æ±‚å–æ¶ˆ | å†…ç½® CancelToken | éœ€ AbortController |

### ç¤ºä¾‹å¯¹æ¯”

```typescript
// Axios
const response = await axios.post('/api/upload', formData, {
    params: { skip_llm: 'true' }
});
const data = response.data;

// Fetch
const response = await fetch('/api/upload?skip_llm=true', {
    method: 'POST',
    body: formData,
});
if (!response.ok) throw new Error(response.statusText);
const data = await response.json();
```

### Axios æ³›å‹æŒ‡å®šå“åº”ç±»å‹

```typescript
// æ³›å‹ <T> æŒ‡å®šçš„æ˜¯ response.data çš„ç±»å‹ï¼Œä¸æ˜¯æ•´ä¸ª responseï¼
const response = await axios.post<TranscribeResponse>(url, data);

response        // ç±»å‹: AxiosResponse<TranscribeResponse>
response.data   // ç±»å‹: TranscribeResponse â† æ³›å‹æŒ‡å®šçš„æ˜¯è¿™é‡Œ
```

**åŸç†**ï¼šAxios å†…éƒ¨å®šä¹‰äº† `AxiosResponse<T>` ç±»å‹ï¼š
```typescript
interface AxiosResponse<T = any> {
    data: T;           // â† æ³›å‹å‚æ•°ç”¨åœ¨è¿™é‡Œ
    status: number;
    headers: ...;
}
```

---

## 2. Vite Proxy vs CORS

> **ä¸€å¥è¯**ï¼šå‰ç«¯ `vite.config.ts` çš„ä»£ç†è®¾ç½®æ˜¯ä¸ºäº†å°† API è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æœåŠ¡ã€‚**åªåœ¨å¼€å‘ç¯å¢ƒæœ‰ç”¨**ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦åç«¯ CORSã€‚

```
æµè§ˆå™¨ â†’ Vite (5173) â†’ åç«¯ (8000/8001)
         â†‘ åŒæº         â†‘ ä»£ç†è½¬å‘
```

| åœºæ™¯ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| å¼€å‘ | Vite Proxy |
| ç”Ÿäº§ | åç«¯ CORS |

---

## 3. Fetch Response è¯»å–

> **ä¸€å¥è¯**ï¼š`fetch` è¿”å›çš„ Response æœ‰å¤šç§è¯»å–æ–¹æ³•ï¼Œæ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©ã€‚

```typescript
await response.json()        // â†’ Object (API)
await response.text()        // â†’ string
await response.arrayBuffer() // â†’ ArrayBuffer (éŸ³é¢‘/æ–‡ä»¶)
await response.blob()        // â†’ Blob
```

âš ï¸ Response body åªèƒ½è¯»å–**ä¸€æ¬¡**ï¼

---

## 4. Blob

> **ä¸€å¥è¯**ï¼šBlob æ˜¯æµè§ˆå™¨ä¸­è¡¨ç¤º**äºŒè¿›åˆ¶æ•°æ®**çš„å¯¹è±¡ï¼Œç”¨äºæ–‡ä»¶å¤„ç†ã€‚

```typescript
// åˆ›å»º
const blob = new Blob([data], { type: 'audio/wav' });

// è½¬ URLï¼ˆé¢„è§ˆ/ä¸‹è½½ï¼‰
const url = URL.createObjectURL(blob);

// ä¸Šä¼ 
formData.append('file', blob, 'audio.wav');
```

| Blob | ArrayBuffer |
|------|-------------|
| ä¸å¯å˜ã€å¸¦ MIME ç±»å‹ | å¯æ“ä½œå­—èŠ‚ |

---

## 5. FormData

> **ä¸€å¥è¯**ï¼šFormData æ˜¯é”®å€¼å¯¹é›†åˆï¼Œç”¨äºæ„å»ºè¡¨å•æ•°æ®ä¸Šä¼ ã€‚

```typescript
const formData = new FormData();
formData.append('file', blob, 'filename.wav');  // (å­—æ®µå, å€¼, æ–‡ä»¶å)
formData.append('name', 'test');                // (å­—æ®µå, å€¼)
```

**æ³¨æ„**ï¼šåŒä¸€ä¸ª key å¯ä»¥ append å¤šæ¬¡ï¼ˆå¤šæ–‡ä»¶ä¸Šä¼ ï¼‰

---

## 6. audioUtils.ts éª¨æ¶

> **ä¸€å¥è¯**ï¼šä»éŸ³é¢‘ URL æˆªå–æŒ‡å®šæ—¶é—´æ®µï¼Œç¼–ç ä¸º WAV Blob

```
extractAudioSegment(url, start, end) â†’ Blob

æµç¨‹ï¼šä¸‹è½½ â†’ è§£ç  â†’ æˆªå– â†’ ç¼–ç  WAV
```

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| AudioContext | Web Audio API æ ¸å¿ƒ |
| AudioBuffer | è§£ç åçš„æ³¢å½¢æ•°æ® |
| sampleRate | é‡‡æ ·ç‡ (44100 = æ¯ç§’44100é‡‡æ ·) |

---

## 7. è§£æ„èµ‹å€¼ + é»˜è®¤å€¼

```typescript
const { filename = 'audio.wav', skipLlm = true } = options;

// ç­‰ä»·äº
const filename = options.filename ?? 'audio.wav';
const skipLlm = options.skipLlm ?? true;
```

---

## 8. Promise è½®è¯¢æ¨¡å¼

> **ä¸€å¥è¯**ï¼š`async function` é‡Œï¼Œ`return` = fulfilledï¼Œ`throw` = rejected

### è½®è¯¢æµç¨‹

```
æŸ¥è¯¢çŠ¶æ€ â†’ completed? â†’ return (fulfilled)
         â†’ failed?    â†’ throw (rejected)  
         â†’ éƒ½ä¸æ˜¯     â†’ sleep 1ç§’ â†’ ç»§ç»­è½®è¯¢
```

### sleep å‡½æ•°ï¼ˆé‡è¦æ¨¡å¼ï¼‰

```typescript
// ç»å…¸å†™æ³•ï¼šè®© Promise ç­‰å¾…æŒ‡å®šæ¯«ç§’
await new Promise(resolve => setTimeout(resolve, 1000));

// å°è£…ç‰ˆ
function sleep(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
}
await sleep(1000);
```

**åŸç†**ï¼š`setTimeout(resolve, ms)` ç›´æ¥æŠŠ `resolve` å‡½æ•°ä¼ ç»™ `setTimeout`ï¼Œms æ¯«ç§’åè‡ªåŠ¨è°ƒç”¨ã€‚

---

## 9. HTML title å±æ€§

> **ä¸€å¥è¯**ï¼šåŸç”Ÿ HTML å±æ€§ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ”¯æŒï¼Œæ˜¾ç¤ºæµè§ˆå™¨åŸç”Ÿå°æç¤ºæ¡†ã€‚

```html
<button title="è¿™æ˜¯æç¤º">æŒ‰é’®</button>
```

âš ï¸ ä¸ Element Plus çš„ `el-tooltip` ä¸åŒï¼Œ`title` æ˜¯åŸç”Ÿçš„ã€ä¸å¯è‡ªå®šä¹‰æ ·å¼ã€‚

---

## 10. el-button text å±æ€§

> **ä¸€å¥è¯**ï¼šElement Plus æŒ‰é’®å±æ€§ï¼Œç§»é™¤èƒŒæ™¯å’Œè¾¹æ¡†ï¼Œåªä¿ç•™æ–‡å­—/å›¾æ ‡ã€‚

| å±æ€§ | æ•ˆæœ |
|------|------|
| æ—  | é»˜è®¤æŒ‰é’®ï¼ˆæœ‰èƒŒæ™¯ã€è¾¹æ¡†ï¼‰ |
| `text` | é€æ˜èƒŒæ™¯ï¼Œåªæœ‰æ–‡å­— |
| `link` | é“¾æ¥æ ·å¼ |

```vue
<el-button>é»˜è®¤</el-button>
<el-button text>æ–‡å­—æŒ‰é’®</el-button>
```

---

## 11. Tailwind å°æ•°é—´è·

> **ä¸€å¥è¯**ï¼šTailwind v3+ æ”¯æŒå°æ•°å€¼ï¼Œæ— éœ€è‡ªå®šä¹‰ `[]` å†™æ³•ã€‚

| ç±»å | ç­‰ä»· CSS |
|------|----------|
| `gap-0.5` | 2px |
| `gap-1` | 4px |
| `gap-1.5` | 6px |
| `gap-2.5` | 10px |
| `gap-3.5` | 14px |

---

## 12. flex-1 vs shrink-0

> **ä¸€å¥è¯**ï¼š`flex-1` å æ»¡ç©ºé—´ï¼Œ`shrink-0` ç¦æ­¢æ”¶ç¼©ã€‚

| ç±»å | ç­‰ä»· CSS | å«ä¹‰ |
|------|----------|------|
| `flex-1` | `flex: 1 1 0%` | å¯ä¼¸å¯ç¼©ï¼Œå æ»¡å‰©ä½™ |
| `shrink-0` | `flex-shrink: 0` | ç¦æ­¢æ”¶ç¼©ï¼Œä¿æŒåŸå°ºå¯¸ |

```html
<div class="flex">
  <div class="shrink-0">LOGO</div>    <!-- å›ºå®šå®½åº¦ -->
  <div class="flex-1">å†…å®¹åŒº</div>    <!-- å¡«æ»¡å‰©ä½™ -->
</div>
```

---

## 13. Vue äº‹ä»¶ä¿®é¥°ç¬¦

> **ä¸€å¥è¯**ï¼š`.prevent` é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œ`.stop` é˜»æ­¢å†’æ³¡ã€‚

```vue
<!-- é˜»æ­¢ Enter åœ¨ textarea ä¸­æ¢è¡Œ -->
<el-input @keydown.enter.prevent="save" />

<!-- å¸¸ç”¨ä¿®é¥°ç¬¦ -->
@click.stop      <!-- é˜»æ­¢å†’æ³¡ -->
@click.prevent   <!-- é˜»æ­¢é»˜è®¤è¡Œä¸º -->
@click.once      <!-- åªè§¦å‘ä¸€æ¬¡ -->
```

### âš ï¸ ä¿®é¥°ç¬¦åªé€‚ç”¨äºåŸç”Ÿ DOM äº‹ä»¶

```vue
<!-- âœ… åŸç”Ÿäº‹ä»¶ï¼šä¿®é¥°ç¬¦æœ‰æ•ˆ -->
<div @click.stop="handleClick">

<!-- âŒ è‡ªå®šä¹‰äº‹ä»¶ï¼šä¿®é¥°ç¬¦æ— æ•ˆ -->
<BaseWaveSurfer @region-clicked.stop="handleRegionClicked" />
```

**åŸå› **ï¼š`@region-clicked` æ˜¯ç»„ä»¶ emit çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå®ƒçš„å‚æ•° `e` åªæ˜¯æ™®é€šå‚æ•°ï¼Œä¸æ˜¯ Vue å¯ä»¥æ‹¦æˆªçš„äº‹ä»¶å¯¹è±¡ã€‚

**è§£å†³**ï¼šåœ¨å¤„ç†å‡½æ•°ä¸­æ‰‹åŠ¨è°ƒç”¨ `e.stopPropagation()`ï¼š

```typescript
const handleRegionClicked = (region: Region, e: MouseEvent) => {
    e.stopPropagation()  // â† å¿…é¡»æ‰‹åŠ¨è°ƒç”¨
    // ...
}
```

---

## 14. Vue Composable

> **ä¸€å¥è¯**ï¼šVue 3 å¯å¤ç”¨é€»è¾‘å‡½æ•°ï¼Œå°è£… ref/computed/æ–¹æ³•ï¼Œè®©ç»„ä»¶ä¸“æ³¨ UIã€‚

### åŸºæœ¬ç»“æ„

```typescript
export function useSomething(options) {
  // 1. çŠ¶æ€ï¼ˆå†…éƒ¨ç®¡ç†ï¼‰
  const state = ref(...)
  const status = ref<'idle' | 'loading' | 'done'>('idle')
  
  // 2. æ–¹æ³•ï¼ˆæ“ä½œçŠ¶æ€ï¼‰
  const doSomething = async () => { ... }
  
  // 3. è¿”å›ï¼ˆæš´éœ²ç»™ç»„ä»¶ï¼‰
  return { state, status, doSomething }
}
```

### ä»€ä¹ˆæ—¶å€™è¯¥æå– Composableï¼Ÿ

| ä¿¡å· | ç¤ºä¾‹ |
|------|------|
| ä¸€ç»„ç›¸å…³çš„ ref + æ“ä½œå‡½æ•° | `status`, `result`, `handleClick` æ€»æ˜¯ä¸€èµ· |
| UI æ— å…³çš„ä¸šåŠ¡é€»è¾‘ | API è°ƒç”¨ã€æ•°æ®å¤„ç† |
| å¯èƒ½åœ¨å…¶ä»–ç»„ä»¶å¤ç”¨ | å­—å…¸æŸ¥è¯¢ã€AI åˆ†æ |
| ç»„ä»¶è¶…è¿‡ 300 è¡Œ | è€ƒè™‘æ‹†åˆ† |

### å®é™…ä¾‹å­ï¼šuseAiAnalysis

```typescript
// composables/useAiAnalysis.ts
export function useAiAnalysis(options) {
  // çŠ¶æ€
  const analysisResult = ref<Result | null>(null)
  const aiStatus = ref<'default' | 'loading' | 'active'>('default')
  
  // æ–¹æ³•
  const handleAiClick = async () => { ... }
  const getTypeClass = (type: string) => { ... }
  
  // è¿”å›
  return { analysisResult, aiStatus, handleAiClick, getTypeClass }
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const aiAnalysis = useAiAnalysis({ fullContext, focusSegment })
aiAnalysis.handleAiClick()
```

### ç”Ÿå‘½å‘¨æœŸ

- **åˆ›å»º**ï¼šç»„ä»¶ `setup()` æ‰§è¡Œæ—¶
- **é”€æ¯**ï¼šç»„ä»¶å¸è½½æ—¶ï¼ˆå†…éƒ¨ ref è¢«åƒåœ¾å›æ”¶ï¼‰

### vs å…¨å±€çŠ¶æ€ï¼ˆPiniaï¼‰

```typescript
// âŒ å…¨å±€å•ä¾‹ï¼ˆå¤šç»„ä»¶å…±äº«åŒä¸€ä»½æ•°æ®ï¼‰
const globalRef = ref(0)
export function useX() { return { x: globalRef } }

// âœ… æ¯ä¸ªç»„ä»¶ç‹¬ç«‹å®ä¾‹
export function useX() {
  const x = ref(0)  // æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯æ–°çš„
  return { x }
}

// éœ€è¦å…¨å±€å…±äº«ï¼Ÿç”¨ Pinia store
```

---

## 15. Map vs Object

> **ä¸€å¥è¯**ï¼šMap æ”¯æŒä»»æ„é”®ç±»å‹ã€ä¿è¯é¡ºåºï¼ŒåŠ¨æ€ key åœºæ™¯æ›´é€‚åˆã€‚

### å¯¹æ¯”

| ç‰¹æ€§ | `Map<K, V>` | `{ [key: string]: V }` |
|------|-------------|------------------------|
| é”®ç±»å‹ | ä»»æ„ï¼ˆå¯¹è±¡ã€æ•°å­—ç­‰ï¼‰ | åªèƒ½ string/symbol |
| é”®é¡ºåº | ä¿è¯æ’å…¥é¡ºåº | ä¸ä¿è¯ |
| é¢‘ç¹å¢åˆ  | æ›´å¿« | è¾ƒæ…¢ |
| å¤§å° | `.size` | `Object.keys().length` |

### ä½¿ç”¨ç¤ºä¾‹

```typescript
const map = new Map<string, Result>();

map.set(id, result);      // è®¾ç½®
map.get(id);              // è·å–
map.delete(id);           // åˆ é™¤
map.has(id);              // æ£€æŸ¥
map.size;                 // å¤§å°

// éå†
for (const [key, value] of map) { ... }
```

### é€‚ç”¨åœºæ™¯

- åŠ¨æ€å¢åˆ é”®å€¼ï¼ˆå¦‚é«˜äº® ID â†’ åˆ†æç»“æœï¼‰
- éœ€è¦ä¿æŒæ’å…¥é¡ºåº
- é”®ä¸æ˜¯çº¯å­—ç¬¦ä¸²

---

## 16. Tailwind groupï¼ˆçˆ¶å­è”åŠ¨ï¼‰

> **ä¸€å¥è¯**ï¼šçˆ¶å…ƒç´ åŠ  `group`ï¼Œå­å…ƒç´ ç”¨ `group-hover:` å®ç°æ‚¬åœçˆ¶å…ƒç´ æ—¶æ”¹å˜å­å…ƒç´ æ ·å¼ã€‚

### åŸºæœ¬ç”¨æ³•

```html
<div class="group">
  <span class="group-hover:text-red-500">
    Hover parent to make this red
  </span>
</div>
```

### å®é™…ä¾‹å­

```html
<div class="group">  <!-- æ—¶é—´æˆ³å®¹å™¨ -->
  <i-tabler-chevron-left 
    class="w-0 opacity-0 group-hover:w-3 group-hover:opacity-100"
  />
  <!-- é»˜è®¤éšè—ï¼Œhover çˆ¶å®¹å™¨æ—¶æ˜¾ç¤º -->
</div>
```

### å¸¸ç”¨å˜ä½“

| å˜ä½“ | è§¦å‘æ¡ä»¶ |
|------|----------|
| `group-hover:` | çˆ¶å…ƒç´ è¢«æ‚¬åœ |
| `group-focus:` | çˆ¶å…ƒç´ è·å¾—ç„¦ç‚¹ |
| `group-active:` | çˆ¶å…ƒç´ è¢«ç‚¹å‡» |

---

## 17. é—­åŒ… (Closure)

> **ä¸€å¥è¯**ï¼šå‡½æ•° + å®ƒèƒ½"è®°ä½"çš„å¤–éƒ¨å˜é‡ = é—­åŒ…ã€‚

### æ¦‚å¿µ

é—­åŒ…è®©å‡½æ•°èƒ½å¤Ÿè®¿é—®**åˆ›å»ºæ—¶**çš„ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°åœ¨å…¶ä»–åœ°æ–¹æ‰§è¡Œã€‚

### åŸºç¡€ç¤ºä¾‹

```javascript
function createCounter() {
  let count = 0  // â† å¤–éƒ¨å˜é‡
  
  return function() {  // â† è¿”å›çš„å‡½æ•°"è®°ä½"äº† count
    count++
    return count
  }
}

const counter = createCounter()
counter()  // 1
counter()  // 2
counter()  // 3  â† æ¯æ¬¡è°ƒç”¨éƒ½èƒ½è®¿é—®é‚£ä¸ª count
```

### ä¸ºä»€ä¹ˆå«"é—­åŒ…"ï¼Ÿ

å‡½æ•°æŠŠå¤–éƒ¨å˜é‡"å°é—­/åŒ…è£¹"åœ¨è‡ªå·±èº«ä¸Šï¼Œå¸¦èµ°äº†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  function()             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ count = 0     â”‚ â†  â”‚ è¢«"åŒ…"è¿›æ¥äº†
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18. Vue äº‹ä»¶é—­åŒ…æ¨¡å¼

> **ä¸€å¥è¯**ï¼šçˆ¶ç»„ä»¶ç”¨é—­åŒ…æ•è· v-for çš„ä¸Šä¸‹æ–‡ï¼Œå­ç»„ä»¶åªéœ€ emit ç®€å•æ•°æ®ã€‚

### é—®é¢˜åœºæ™¯

v-for æ¸²æŸ“å¤šä¸ªå­ç»„ä»¶ï¼Œå­ç»„ä»¶è§¦å‘äº‹ä»¶æ—¶ï¼Œçˆ¶ç»„ä»¶éœ€è¦çŸ¥é“æ˜¯**å“ªä¸€ä¸ª**ã€‚

### ä¸¤ç§è§£å†³æ–¹å¼

| æ–¹å¼ | å­ç»„ä»¶ emit | çˆ¶ç»„ä»¶ç›‘å¬ |
|------|-------------|------------|
| **ä¼ ç»Ÿæ–¹å¼** | `emit('event', { id, value })` | `@event="handleEvent"` |
| **é—­åŒ…æ–¹å¼** | `emit('event', value)` | `@event="(val) => handler(id, val)"` |

### å®é™…ä»£ç ï¼ˆé¡¹ç›®ä¸­çš„ä¾‹å­ï¼‰

```vue
<!-- AudioSlicer.vue (çˆ¶ç»„ä»¶) -->
<SliceCard 
  v-for="region in regionsList"
  :key="region.id"
  @toggle-favorite="(val) => handleToggleFavorite(region.id, val)"
  <!--             â†‘ é—­åŒ…æ•è·äº†å½“å‰å¾ªç¯çš„ region.id -->
/>
```

```typescript
// SliceCard.vue (å­ç»„ä»¶) - åª emit å€¼ï¼Œä¸éœ€è¦çŸ¥é“ id
const toggleFavorite = () => {
  isFavorite.value = !isFavorite.value
  emit('toggle-favorite', isFavorite.value)  // â† åªä¼  true/false
}
```

```typescript
// AudioSlicer.vue (çˆ¶ç»„ä»¶) - æ”¶åˆ° regionId å’Œ value
const handleToggleFavorite = (regionId: string, isFavorite: boolean) => {
  const region = regionsList.value.find(r => r.id === regionId)
  if (region) region.isFavorite = isFavorite
}
```

### é—­åŒ…å¦‚ä½•å·¥ä½œ

```javascript
// v-for æ¯æ¬¡è¿­ä»£éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ç®­å¤´å‡½æ•°
// æ¯ä¸ªç®­å¤´å‡½æ•°"è®°ä½"äº†å½“æ—¶çš„ region.id

// è¿­ä»£1: region = { id: 'abc' }
const handler1 = (val) => handleToggleFavorite('abc', val)  // è®°ä½ 'abc'

// è¿­ä»£2: region = { id: 'xyz' }
const handler2 = (val) => handleToggleFavorite('xyz', val)  // è®°ä½ 'xyz'
```

### ä¼˜ç‚¹

- **å­ç»„ä»¶æ›´çº¯ç²¹**ï¼šåªå…³å¿ƒè‡ªå·±çš„çŠ¶æ€å˜åŒ–
- **çˆ¶ç»„ä»¶æŒæ§ä¸Šä¸‹æ–‡**ï¼šçŸ¥é“æ˜¯å“ªä¸ªå…ƒç´ 
- **ä»£ç æ›´ç®€æ´**ï¼šå­ç»„ä»¶ emit æ›´å°‘æ•°æ®

---

## 19. é«˜é¢‘äº‹ä»¶å¤„ç†ç­–ç•¥

> **ä¸€å¥è¯**ï¼šæ‹–æ‹½ã€æ»šåŠ¨ã€resize ç­‰é«˜é¢‘äº‹ä»¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¦åˆ™å¯èƒ½äº§ç”ŸçŠ¶æ€ä¸ä¸€è‡´ã€‚

### å¸¸è§é«˜é¢‘äº‹ä»¶

| äº‹ä»¶ | è§¦å‘é¢‘ç‡ |
|------|---------|
| `mousemove` / `touchmove` | æ¯å¸§ï¼ˆ60fps = 16msï¼‰ |
| `scroll` | æ»šåŠ¨æ—¶æŒç»­è§¦å‘ |
| `resize` | çª—å£è°ƒæ•´æ—¶æŒç»­è§¦å‘ |
| WaveSurfer `region-updated` | æ‹–æ‹½åŒºåŸŸè¾¹ç•Œæ—¶æŒç»­è§¦å‘ |

### å¤„ç†ç­–ç•¥

| ç­–ç•¥ | åŸç† | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **é˜²æŠ– (Debounce)** | ç­‰ç”¨æˆ·åœæ­¢æ“ä½œ N æ¯«ç§’åæ‰æ‰§è¡Œ | æœç´¢è¾“å…¥ã€è¡¨å•éªŒè¯ |
| **èŠ‚æµ (Throttle)** | æ¯ N æ¯«ç§’æœ€å¤šæ‰§è¡Œä¸€æ¬¡ | æ»šåŠ¨åŠ è½½ã€å®æ—¶é¢„è§ˆ |
| **å…¨é‡æ¸…ç†** | æ¯æ¬¡éƒ½æ¸…ç†æ‰€æœ‰æ—§çŠ¶æ€å†åˆ›å»ºæ–°çš„ | çŠ¶æ€å¯èƒ½ä¸ä¸€è‡´çš„åœºæ™¯ |

### å®é™…æ¡ˆä¾‹ï¼šWaveSurfer åŒºåŸŸé‡å  Bug

**é—®é¢˜**ï¼šæ‹–æ‹½è°ƒæ•´ region è¾¹ç•Œæ—¶ï¼Œé«˜é¢‘è§¦å‘å¯¼è‡´åˆ›å»ºå¤šä¸ªåŒ ID åŒºåŸŸï¼Œäº§ç”Ÿè§†è§‰é‡å ã€‚

**åŸå› **ï¼š
```typescript
// âŒ find() åªåˆ ä¸€ä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªåŒ ID åŒºåŸŸå°±æ¼åˆ äº†
const region = existingRegions.find(r => r.id === REGION_ID)
if (region) region.remove()
```

**ä¿®å¤**ï¼šä½¿ç”¨å…¨é‡æ¸…ç†
```typescript
// âœ… filter() æ‰¾æ‰€æœ‰åŒ ID åŒºåŸŸï¼Œå…¨éƒ¨åˆ é™¤
const regionsToRemove = existingRegions.filter(r => r.id === REGION_ID)
regionsToRemove.forEach(r => r.remove())
```

### æ•™è®­

> ğŸ¯ **é«˜é¢‘äº‹ä»¶ + çŠ¶æ€åˆ›å»º = å¿…é¡»è€ƒè™‘å¹¶å‘/ç«æ€é—®é¢˜**
> 
> å³ä½¿ä½ ä»¥ä¸º"æ¯æ¬¡åªä¼šæœ‰ä¸€ä¸ª"ï¼Œé«˜é¢‘è§¦å‘ä¸‹å¯èƒ½äº§ç”Ÿå¤šä¸ªã€‚
